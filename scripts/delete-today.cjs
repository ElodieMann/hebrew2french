const { initializeApp } = require("firebase/app");
const { getFirestore, collection, getDocs, deleteDoc, doc } = require("firebase/firestore");
const readline = require("readline");

const firebaseConfig = {
  apiKey: "AIzaSyCirsTIEJXkj6SDL6W-inUV3Gw0uOyH_is",
  authDomain: "hebrew2french.firebaseapp.com",
  projectId: "hebrew2french",
  storageBucket: "hebrew2french.firebasestorage.app",
  messagingSenderId: "890776485340",
  appId: "1:890776485340:web:f73146abecf71d3b092319",
  measurementId: "G-WL6TLLQB9J"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Questions ajoutÃ©es par erreur (basÃ© sur le terminal)
const questionsToDelete = [
  // Session 1 - ××‘×•× ×œ×§×•×¡××˜×™×§×” (13 questions)
  "×§×•×¡××˜×•×œ×•×’×™×” ×”×™×:",
  "×”×™×’×™×™× ×” ×¦×™×‘×•×¨×™×ª:",
  "×”×™×’×™×™× ×” ××™×©×™×ª ×”×™×:",
  "×‘××§×¦×•×¢ ×”×§×•×¡××˜×™×§×” ×§×™×™× ×§×©×¨ ×”×“×•×§ ×‘×™×Ÿ ×”×§×•×¡××˜×™×§××™×ª ×œ×œ×§",
  "×”×§×•×¡××˜×™×§×”:",
  "×‘×’×¨×× ×™×” ×”×“×’×© ×”×•×:",
  "×¢×’×œ×ª ×”×˜×™×¤×•×œ×™×:",
  "×›×œ×™ ×¢×–×¨ ×”××•× ×—×™× ×¢×œ ×¢×’×œ×ª ×”×˜×™×¤×•×œ×™×:",
  "××”×™ ×“×•×’×× ×œ×”×™×’×™×™× ×” ×¦×™×‘×•×¨×™×ª?",
  "××™×–×” ××©×¤×˜ × ×›×•×Ÿ?",
  "××” ××™× ×• ×›×œ×œ × ×›×•×Ÿ ×œ×’×‘×™ ××›×•×Ÿ ×”×§×•×¡××˜×™×§××™×ª?",
  "××™×–×• ××”×œ×§×•×—×•×ª ×œ× ×ª×ª×§×‘×œ ×œ×˜×™×¤×•×œ ×‘××›×•×Ÿ ×”×§×•×¡××˜×™?",
  "××” ×××¤×™×™×Ÿ ××ª ×”×§×•×¡××˜×™×§×” ×‘×™×•×•×Ÿ ×”×¢×ª×™×§×”?",
  
  // Session 2 - × ×™×§×•×™ ×¨××©×•× ×™ (49 questions)
  "×™×ª×¨×•× ×•×ª×™×• ×©×œ ×¡×‘×•×Ÿ ×œ×œ× ×¡×‘×•×Ÿ ×œ×¢×•××ª ×¡×‘×•×Ÿ ×§×œ××¡×™ ×”×:",
  "××™×–×” ××‘×™×Ÿ ×”×—×•××¨×™× ×”×‘××™× ××™× ×• ×©×™×™×š ×œ× ×™×§×•×™ ×”×¨××©×•× ×™?",
  "×—×©×™×‘×•×ª×• ×©×œ ×—×œ×‘ ×”×¤× ×™×:",
  "× ×™×§×•×™ ×¤× ×™× ×¨××©×•× ×™ × ×¢×©×”:",
  "×—×œ×‘ ×¤× ×™× ××›×™×œ:",
  "××™ ×¤× ×™× ××›×™×œ×™× ×‘×“×¨×š ×›×œ×œ:",
  "×©××Ÿ ×”×™×“×¨×•×¤×™×œ×™ ××ª××™× ×œ×¢×•×¨:",
  "××”×• ×”×ª×›×©×™×¨ ×”××ª××™× ×‘×™×•×ª×¨ ×œ×”×¡×¨×ª ××™×¤×•×¨ ××Ÿ ×”×¢×™× ×™×™×?",
  "××ª×™ ×¡×‘×•×Ÿ × ×—×©×‘ ×œ×¡×‘×•×Ÿ ×œ×œ× ×¡×‘×•×Ÿ?",
  "×”× ×™×§×•×™ ×”×¨××©×•× ×™ ×× ×§×” ××¢×•×¨× ×• ××ª:",
  "×ª×¤×§×™×“ ×”××œ×›×•×”×•×œ ×‘×—×œ×‘ ×¤× ×™×:",
  "×™×ª×¨×•× ×•×ª ×”×¡×‘×•×Ÿ ×œ×œ× ×¡×‘×•×Ÿ:",
  "×”×¡×¨×ª ××™×¤×•×¨ ×”×¢×™× ×™×™×:",
  "×ª×›×•× ×•×ª ×”×©××Ÿ ×”×”×™×“×¨×•×¤×™×œ×™:",
  "×—×œ×‘ ×¤× ×™×:",
  "×©××Ÿ ×”×™×“×¨×•×¤×™×œ×™:",
  "×›××•×ª ×”××œ×›×•×”×•×œ ×”×¨×¦×•×™×” ×‘××™ ×¤× ×™× ×”×™×:",
  "×”×ª×›×©×™×¨ ×”×˜×•×‘ ×‘×™×•×ª×¨ ×œ× ×™×§×•×™ ×¨××©×•× ×™ ×™×§×‘×¢ ×œ×¤×™:",
  "×—×©×™×‘×•×ª ×”× ×™×§×•×™ ×”×¨××©×•× ×™ ×‘×ª×—×™×œ×ª ×”×˜×™×¤×•×œ ×§×•×¡××˜×™:",
  "××˜×¨×ª ×”× ×™×§×•×™ ×”×¨××©×•× ×™ ×”×™×:",
  "×“×™×’×¨×™×–×™× ×’ ×”×•×:",
  "×”×××•×œ×¡×™×” ×”×™× ×”:",
  "×—×•××¨ ×œ×™×¤×•×¤×™×œ×™ ×”×•×:",
  "××” ×©×§×•×‘×¢ ××ª ×¡×•×’ ×”×××•×œ×¡×™×” ×”×•×:",
  "×ª×¤×§×™×“ ×—×œ×‘ ×”×¤× ×™×:",
  "×¡×× ×™ ××ª ×”××©×¤×˜ ×”× ×›×•×Ÿ:",
  "××™×–×” ××”×—×•××¨×™× ×”×‘××™× ××™× ×• ××©××© ×œ× ×™×§×•×™ ×¨××©×•× ×™?",
  "×ª×¤×§×™×“ ×”×—×•××¨×™× ×”×¤×¢×™×œ×™×:",
  "××ª×™ ×ª××œ×™×¦×™ ×œ×œ×§×•×—×” ×œ×¢×©×•×ª × ×™×§×•×™ ×¨××©×•× ×™ ×‘×‘×™×ª?",
  "×××•×œ×¡×™×” O/W:",
  "×¡×‘×•×Ÿ ×œ×œ× ×¡×‘×•×Ÿ ×”×•× ×¡×‘×•×Ÿ:",
  "×”×¨×›×‘ ××™ ×”×¤× ×™× ×”×™× ×•:",
  "××œ×›×•×”×•×œ ×”×•× ×”×›×œ ×¤×¨×˜ ×œ:",
  "××” ×ª×¤×§×™×“ ×”× ×™×§×•×™ ×”×¨××©×•× ×™:",
  "×ª×›×©×™×¨ × ×™×§×•×™ ×§×•×¡××˜×™ ×”×•×:",
  "××™ ×¤× ×™× ×©××™× × ××›×™×œ×™× ××œ×›×•×”×•×œ ×”×:",
  "×™×ª×¨×•×Ÿ ×”×¡×‘×•×Ÿ ×œ×œ× ×¡×‘×•×Ÿ:",
  "××—×“ ××ª×¤×§×™×“×™ ××™ ×”×¤× ×™× ×‘× ×™×§×•×™ ×”×¨××©×•× ×™ ×”×•× ×œ×”×¡×™×¨ ××ª:",
  "××™×–×” ××”×ª×›×©×™×¨×™× ×”×‘××™× ××›×™×œ ×¤××–×” ×©×•×× ×™×ª?",
  "××™×–×” ×ª×›×©×™×¨ ×ª×‘×—×¨×™ ×‘× ×™×§×•×™ ×”×¨××©×•× ×™ ×œ×œ×§×•×—×” ×¢× ×¢×•×¨ ×¨×’×™×œ",
  "×—×•××¨ ×”×™×“×¨×•×¤×™×œ×™ ×”×•×:",
  "×‘××œ×• ××§×¨×™× ×‘××›×•×Ÿ ×™×© ×œ×”×™×× ×¢ ×× ×™×§×•×™ ×¨××©×•× ×™:",
  "××”×• ×”×ª×›×©×™×¨ ×”××›×™×œ ×•×–×œ×™×Ÿ, ××™×, ×××•×œ×’×˜×•×¨ ×•××™×¦×•×™ ××œ×¤×¤×•",
  "××” ×”×”×‘×“×œ ×‘×™×Ÿ ×¡×‘×•×Ÿ ××•×¦×§ ×œ×¡×‘×•×Ÿ × ×•×–×œ×™?",
  "×–×”×™ ××ª ×”×ª×›×©×™×¨ ×”××•×¨×›×‘ ×××™×, ×’×œ×™×¦×¨×™×Ÿ ×•×§××•××™×œ ××–×•×œ×Ÿ!",
  "××™×–×” ×ª×›×©×™×¨ ×ª×•××œ×¥ ×‘×™×•×ª×¨ ×‘× ×™×§×•×™ ×”×¨××©×•× ×™ ×œ×œ×§×•×—×” ×¢× ×¢×•",
  "×¡×‘×•×Ÿ ×œ×œ× ××œ×§×œ×™ ×”×™× ×•:",
  "×¡×•×“×™×•× ×œ××•×¨×œ ×¡×•×œ×¤×˜ ×”×•×:",
];

async function deleteToday() {
  console.log("\nğŸ“ Chargement des questions...\n");
  
  const snapshot = await getDocs(collection(db, "questions"));
  const questions = snapshot.docs.map((d) => ({ id: d.id, ...d.data() }));
  
  console.log(`ğŸ“Š Total questions dans Firebase: ${questions.length}\n`);
  
  // Trouver les questions Ã  supprimer (match partiel du dÃ©but)
  const toDelete = questions.filter((q) => {
    return questionsToDelete.some((text) => q.question.startsWith(text));
  });
  
  console.log(`ğŸ—‘ï¸  ${toDelete.length} questions trouvÃ©es Ã  supprimer:\n`);
  toDelete.forEach((q, i) => {
    console.log(`   ${i + 1}. ${q.question.substring(0, 60)}...`);
  });
  
  if (toDelete.length === 0) {
    console.log("âŒ Aucune question Ã  supprimer trouvÃ©e.");
    process.exit(0);
  }
  
  const rl = readline.createInterface({ input: process.stdin, output: process.stdout });
  
  rl.question("\nâš ï¸  Confirmer la suppression ? (oui/non) ", async (answer) => {
    if (answer.toLowerCase() === "oui") {
      console.log("\nğŸ”„ Suppression en cours...");
      for (const q of toDelete) {
        await deleteDoc(doc(db, "questions", q.id));
      }
      console.log(`\nâœ… ${toDelete.length} questions supprimÃ©es !`);
      console.log(`ğŸ“Š Nouveau total: ${questions.length - toDelete.length} questions`);
    } else {
      console.log("âŒ AnnulÃ©");
    }
    rl.close();
    process.exit(0);
  });
}

deleteToday();



